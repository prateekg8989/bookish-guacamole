{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { extendDataItem, getter, Keys, mapTree } from '@progress/kendo-react-common';\nimport { GRID_COL_INDEX_ATTRIBUTE, GRID_ROW_INDEX_ATTRIBUTE } from '../constants';\nvar GROUP_SUBITEMS_COLLECTION = 'items';\nvar LAST_SELECTION_STATE = {};\n\nvar getCellSelection = function getCellSelection(currentSelection, selectedColumn) {\n  if (!currentSelection || Array.isArray(currentSelection) && currentSelection.length === 0) {\n    return [selectedColumn];\n  } else {\n    var foundIndex = currentSelection.findIndex(function (columnIndex) {\n      return columnIndex === selectedColumn;\n    });\n\n    if (foundIndex > -1) {\n      return currentSelection.filter(function (columnIndex) {\n        return columnIndex === selectedColumn;\n      });\n    } else {\n      return currentSelection.concat([selectedColumn]);\n    }\n  }\n};\n/** @hidden */\n\n\nexport var closestTagName = function closestTagName(target, tagName) {\n  var currentTarget = target;\n\n  while (currentTarget) {\n    if (currentTarget.tagName === tagName) {\n      return currentTarget;\n    } else if (currentTarget.tagName === 'TABLE') {\n      return null;\n    }\n\n    currentTarget = currentTarget.parentElement;\n  }\n\n  return null;\n};\n/** @hidden */\n\nexport var getRowIndex = function getRowIndex(element) {\n  if (!element) {\n    return;\n  }\n\n  var rowIndex = element.getAttribute(GRID_ROW_INDEX_ATTRIBUTE);\n  return rowIndex ? parseInt(rowIndex, 10) : undefined;\n};\n/** @hidden */\n\nexport var getColumnIndex = function getColumnIndex(element) {\n  if (!element) {\n    return;\n  }\n\n  var colIndex = element.getAttribute(GRID_COL_INDEX_ATTRIBUTE);\n  return colIndex ? parseInt(colIndex, 10) : undefined;\n};\n/**\n * @hidden\n *\n * Apply the selected field to the data items based on the selected state.\n *\n * @param {{data: any, selectedState:  {[id: string]: boolean | number[]}, dataItemKey: string; selectedField: string; subItemsField?: string; }} options\n * @returns {any[]}\n */\n\nexport var setSelectedState = function setSelectedState(options) {\n  var subItemsField = options.subItemsField || GROUP_SUBITEMS_COLLECTION;\n  var idGetter = getter(options.dataItemKey);\n  return mapTree(options.data, subItemsField, function (item) {\n    var _a;\n\n    return extendDataItem(item, subItemsField, (_a = {}, _a[options.selectedField] = options.selectedState[idGetter(item)], _a));\n  });\n};\n/**\n * Get selected state from the Grid KeyDown event.\n *\n * @param {{event: GridKeyDownEvent, selectedState:  {[id: string]: boolean | number[]}, dataItemKey: string}} options\n * @returns {{[id: string]: boolean | number[]}} - The new selected state.\n */\n\nexport var getSelectedStateFromKeyDown = function getSelectedStateFromKeyDown(options) {\n  var event = options.event,\n      dataItemKey = options.dataItemKey,\n      selectedState = options.selectedState;\n  var syntheticEvent = event.syntheticEvent,\n      nativeEvent = event.nativeEvent,\n      dataItems = event.dataItems,\n      componentId = event.componentId,\n      mode = event.mode,\n      cell = event.cell,\n      selectedField = event.selectedField;\n  var target = nativeEvent.target,\n      ctrlKey = nativeEvent.ctrlKey,\n      metaKey = nativeEvent.metaKey,\n      altKey = nativeEvent.altKey,\n      shiftKey = nativeEvent.shiftKey;\n\n  if (syntheticEvent.isDefaultPrevented() || nativeEvent.keyCode !== Keys.enter) {\n    return selectedState;\n  }\n\n  var tdElement = closestTagName(target, 'TD');\n  var trElement = closestTagName(target, 'TR');\n  var colIndex = getColumnIndex(tdElement);\n  var rowIndex = getRowIndex(trElement);\n  var selectionState = {};\n\n  if (tdElement && trElement && rowIndex !== undefined && colIndex !== undefined) {\n    selectionState = getSelectedState({\n      selectedState: selectedState,\n      dataItemKey: dataItemKey,\n      event: {\n        ctrlKey: ctrlKey,\n        metaKey: metaKey,\n        altKey: altKey,\n        shiftKey: shiftKey,\n        dataItems: dataItems,\n        cell: cell,\n        mode: mode,\n        selectedField: selectedField,\n        componentId: componentId,\n        startColIndex: colIndex,\n        endColIndex: colIndex,\n        startRowIndex: rowIndex,\n        endRowIndex: rowIndex,\n        isDrag: false,\n        syntheticEvent: syntheticEvent,\n        nativeEvent: nativeEvent,\n        target: event.target,\n        dataItem: null\n      }\n    });\n  }\n\n  return selectionState;\n};\n/**\n * Get selected state from the Grid selection event.\n *\n * @param {{event: GridSelectionChangeEvent, selectedState:  {[id: string]: boolean | number[]}, dataItemKey: string}} options\n * @returns {{[id: string]: boolean | number[]}} - The new selected state.\n */\n\nexport var getSelectedState = function getSelectedState(options) {\n  var event = options.event,\n      dataItemKey = options.dataItemKey,\n      prevSelectedState = options.selectedState;\n  var dataItems = event.dataItems,\n      startRowIndex = event.startRowIndex,\n      endRowIndex = event.endRowIndex,\n      startColIndex = event.startColIndex,\n      endColIndex = event.endColIndex,\n      cell = event.cell,\n      isDrag = event.isDrag,\n      ctrlKey = event.ctrlKey,\n      shiftKey = event.shiftKey,\n      metaKey = event.metaKey,\n      componentId = event.componentId,\n      mode = event.mode;\n  var idGetter = getter(dataItemKey);\n  var selectionState = {};\n\n  if (mode === 'single') {\n    var currentDataItem = dataItems.slice(startRowIndex, startRowIndex + 1)[0];\n    var itemId = idGetter(currentDataItem);\n    LAST_SELECTION_STATE[componentId] = {\n      rowIndex: startRowIndex,\n      colIndex: startColIndex\n    };\n    selectionState[itemId] = cell ? [startColIndex] : true;\n  } else if (isDrag || !shiftKey && !ctrlKey && !metaKey) {\n    if (!isDrag) {\n      LAST_SELECTION_STATE[componentId] = {\n        rowIndex: startRowIndex,\n        colIndex: startColIndex\n      };\n    }\n\n    var selectedColumns_1 = [];\n\n    for (var i = startColIndex; i <= endColIndex; i++) {\n      selectedColumns_1.push(i);\n    }\n\n    var selectedDataItems = dataItems.slice(startRowIndex, endRowIndex + 1);\n    selectedDataItems.forEach(function (currentItem) {\n      var itemId = idGetter(currentItem);\n      selectionState[itemId] = cell ? selectedColumns_1.slice() : true;\n    });\n  } else {\n    if (ctrlKey || metaKey) {\n      LAST_SELECTION_STATE[componentId] = {\n        rowIndex: startRowIndex,\n        colIndex: startColIndex\n      };\n      var selectedDataItems = dataItems.slice(startRowIndex, endRowIndex + 1);\n      var currentDataItem = selectedDataItems[0];\n      var itemId = idGetter(currentDataItem);\n      selectionState = __assign({}, prevSelectedState);\n      selectionState[itemId] = cell ? getCellSelection(selectionState[itemId], startColIndex) : !selectionState[itemId];\n    } else if (shiftKey) {\n      var lastRowIndex = LAST_SELECTION_STATE[componentId] && LAST_SELECTION_STATE[componentId].rowIndex || 0;\n      var lastColIndex = LAST_SELECTION_STATE[componentId] && LAST_SELECTION_STATE[componentId].colIndex || 0;\n      var currentStartRowIndex = Math.min(lastRowIndex, startRowIndex, endRowIndex);\n      var currentEndRowIndex = Math.max(lastRowIndex, startRowIndex, endRowIndex);\n      var currentStarColIndex = Math.min(lastColIndex, startColIndex, endColIndex);\n      var currentEndColIndex = Math.max(lastColIndex, startColIndex, endColIndex);\n      var selectedColumns_2 = [];\n\n      for (var i = currentStarColIndex; i <= currentEndColIndex; i++) {\n        selectedColumns_2.push(i);\n      }\n\n      var selectedDataItems = dataItems.slice(currentStartRowIndex, currentEndRowIndex + 1);\n      selectedDataItems.forEach(function (currentItem) {\n        var itemId = idGetter(currentItem);\n        selectionState[itemId] = cell ? selectedColumns_2.slice() : true;\n      });\n    }\n  }\n\n  return selectionState;\n};","map":{"version":3,"sources":["../../../src/selection/utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { extendDataItem, getter, Keys, mapTree } from '@progress/kendo-react-common';\nimport { GRID_COL_INDEX_ATTRIBUTE, GRID_ROW_INDEX_ATTRIBUTE } from '../constants';\nvar GROUP_SUBITEMS_COLLECTION = 'items';\nvar LAST_SELECTION_STATE = {};\nvar getCellSelection = function (currentSelection, selectedColumn) {\n    if (!currentSelection || (Array.isArray(currentSelection) && currentSelection.length === 0)) {\n        return [selectedColumn];\n    }\n    else {\n        var foundIndex = currentSelection.findIndex(function (columnIndex) { return columnIndex === selectedColumn; });\n        if (foundIndex > -1) {\n            return currentSelection.filter(function (columnIndex) { return columnIndex === selectedColumn; });\n        }\n        else {\n            return currentSelection.concat([selectedColumn]);\n        }\n    }\n};\n/** @hidden */\nexport var closestTagName = function (target, tagName) {\n    var currentTarget = target;\n    while (currentTarget) {\n        if (currentTarget.tagName === tagName) {\n            return currentTarget;\n        }\n        else if (currentTarget.tagName === 'TABLE') {\n            return null;\n        }\n        currentTarget = currentTarget.parentElement;\n    }\n    return null;\n};\n/** @hidden */\nexport var getRowIndex = function (element) {\n    if (!element) {\n        return;\n    }\n    var rowIndex = element.getAttribute(GRID_ROW_INDEX_ATTRIBUTE);\n    return rowIndex ? parseInt(rowIndex, 10) : undefined;\n};\n/** @hidden */\nexport var getColumnIndex = function (element) {\n    if (!element) {\n        return;\n    }\n    var colIndex = element.getAttribute(GRID_COL_INDEX_ATTRIBUTE);\n    return colIndex ? parseInt(colIndex, 10) : undefined;\n};\n/**\n * @hidden\n *\n * Apply the selected field to the data items based on the selected state.\n *\n * @param {{data: any, selectedState:  {[id: string]: boolean | number[]}, dataItemKey: string; selectedField: string; subItemsField?: string; }} options\n * @returns {any[]}\n */\nexport var setSelectedState = function (options) {\n    var subItemsField = options.subItemsField || GROUP_SUBITEMS_COLLECTION;\n    var idGetter = getter(options.dataItemKey);\n    return mapTree(options.data, subItemsField, function (item) {\n        var _a;\n        return extendDataItem(item, subItemsField, (_a = {},\n            _a[options.selectedField] = options.selectedState[idGetter(item)],\n            _a));\n    });\n};\n/**\n * Get selected state from the Grid KeyDown event.\n *\n * @param {{event: GridKeyDownEvent, selectedState:  {[id: string]: boolean | number[]}, dataItemKey: string}} options\n * @returns {{[id: string]: boolean | number[]}} - The new selected state.\n */\nexport var getSelectedStateFromKeyDown = function (options) {\n    var event = options.event, dataItemKey = options.dataItemKey, selectedState = options.selectedState;\n    var syntheticEvent = event.syntheticEvent, nativeEvent = event.nativeEvent, dataItems = event.dataItems, componentId = event.componentId, mode = event.mode, cell = event.cell, selectedField = event.selectedField;\n    var target = nativeEvent.target, ctrlKey = nativeEvent.ctrlKey, metaKey = nativeEvent.metaKey, altKey = nativeEvent.altKey, shiftKey = nativeEvent.shiftKey;\n    if (syntheticEvent.isDefaultPrevented() || nativeEvent.keyCode !== Keys.enter) {\n        return selectedState;\n    }\n    var tdElement = closestTagName(target, 'TD');\n    var trElement = closestTagName(target, 'TR');\n    var colIndex = getColumnIndex(tdElement);\n    var rowIndex = getRowIndex(trElement);\n    var selectionState = {};\n    if (tdElement && trElement && rowIndex !== undefined && colIndex !== undefined) {\n        selectionState = getSelectedState({\n            selectedState: selectedState,\n            dataItemKey: dataItemKey,\n            event: {\n                ctrlKey: ctrlKey, metaKey: metaKey, altKey: altKey, shiftKey: shiftKey,\n                dataItems: dataItems, cell: cell, mode: mode, selectedField: selectedField, componentId: componentId,\n                startColIndex: colIndex, endColIndex: colIndex, startRowIndex: rowIndex, endRowIndex: rowIndex,\n                isDrag: false,\n                syntheticEvent: syntheticEvent,\n                nativeEvent: nativeEvent,\n                target: event.target,\n                dataItem: null\n            }\n        });\n    }\n    return selectionState;\n};\n/**\n * Get selected state from the Grid selection event.\n *\n * @param {{event: GridSelectionChangeEvent, selectedState:  {[id: string]: boolean | number[]}, dataItemKey: string}} options\n * @returns {{[id: string]: boolean | number[]}} - The new selected state.\n */\nexport var getSelectedState = function (options) {\n    var event = options.event, dataItemKey = options.dataItemKey, prevSelectedState = options.selectedState;\n    var dataItems = event.dataItems, startRowIndex = event.startRowIndex, endRowIndex = event.endRowIndex, startColIndex = event.startColIndex, endColIndex = event.endColIndex, cell = event.cell, isDrag = event.isDrag, ctrlKey = event.ctrlKey, shiftKey = event.shiftKey, metaKey = event.metaKey, componentId = event.componentId, mode = event.mode;\n    var idGetter = getter(dataItemKey);\n    var selectionState = {};\n    if (mode === 'single') {\n        var currentDataItem = dataItems.slice(startRowIndex, startRowIndex + 1)[0];\n        var itemId = idGetter(currentDataItem);\n        LAST_SELECTION_STATE[componentId] = {\n            rowIndex: startRowIndex,\n            colIndex: startColIndex\n        };\n        selectionState[itemId] = cell ? [startColIndex] : true;\n    }\n    else if (isDrag || (!shiftKey && !ctrlKey && !metaKey)) {\n        if (!isDrag) {\n            LAST_SELECTION_STATE[componentId] = {\n                rowIndex: startRowIndex,\n                colIndex: startColIndex\n            };\n        }\n        var selectedColumns_1 = [];\n        for (var i = startColIndex; i <= endColIndex; i++) {\n            selectedColumns_1.push(i);\n        }\n        var selectedDataItems = dataItems.slice(startRowIndex, endRowIndex + 1);\n        selectedDataItems.forEach(function (currentItem) {\n            var itemId = idGetter(currentItem);\n            selectionState[itemId] = cell ? selectedColumns_1.slice() : true;\n        });\n    }\n    else {\n        if (ctrlKey || metaKey) {\n            LAST_SELECTION_STATE[componentId] = {\n                rowIndex: startRowIndex,\n                colIndex: startColIndex\n            };\n            var selectedDataItems = dataItems.slice(startRowIndex, endRowIndex + 1);\n            var currentDataItem = selectedDataItems[0];\n            var itemId = idGetter(currentDataItem);\n            selectionState = __assign({}, prevSelectedState);\n            selectionState[itemId] = cell ? getCellSelection(selectionState[itemId], startColIndex) : !selectionState[itemId];\n        }\n        else if (shiftKey) {\n            var lastRowIndex = (LAST_SELECTION_STATE[componentId] && LAST_SELECTION_STATE[componentId].rowIndex) || 0;\n            var lastColIndex = (LAST_SELECTION_STATE[componentId] && LAST_SELECTION_STATE[componentId].colIndex) || 0;\n            var currentStartRowIndex = Math.min(lastRowIndex, startRowIndex, endRowIndex);\n            var currentEndRowIndex = Math.max(lastRowIndex, startRowIndex, endRowIndex);\n            var currentStarColIndex = Math.min(lastColIndex, startColIndex, endColIndex);\n            var currentEndColIndex = Math.max(lastColIndex, startColIndex, endColIndex);\n            var selectedColumns_2 = [];\n            for (var i = currentStarColIndex; i <= currentEndColIndex; i++) {\n                selectedColumns_2.push(i);\n            }\n            var selectedDataItems = dataItems.slice(currentStartRowIndex, currentEndRowIndex + 1);\n            selectedDataItems.forEach(function (currentItem) {\n                var itemId = idGetter(currentItem);\n                selectionState[itemId] = cell ? selectedColumns_2.slice() : true;\n            });\n        }\n    }\n    return selectionState;\n};\n//# sourceMappingURL=utils.js.map"]},"metadata":{},"sourceType":"module"}